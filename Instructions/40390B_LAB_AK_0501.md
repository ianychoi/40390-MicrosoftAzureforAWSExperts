# Lab 모범 답안:  모듈 5: 가상 네트워킹
## Lab 1: 사용자 정의 경로 구성
  
### 실습 1: 사용자 정의 경로 구성

해당 실습에서는 다음 단계를 포함합니다:

1. 리소스 그룹 템플릿 배포
2. 템플릿 배포 리뷰
3. Azure RM을 위한 라우팅 및 원격 액세스 구성
4. lab 환경 리셋 (옵션)

#### 단계 1: 리소스 그룹 템플릿 배포

1. https://portal.azure.com 에서 Azure 계정으로 로그인합니다.

2. 실습 환경을 셋업하기 위해 GitHub 퀵스타트 저장소에 있는 템플릿을 사용할 것입니다. 브라우저를 열어 https://github.com/Azure/azure-quickstart-templates/tree/master/201-userdefined-routes-appliance 로 이동합니다.

3. 페이지 하단에서 **Deploy to Azure** 버튼을 클릭합니다

4. 다음 값을 지정합니다:

- 구독: 이용자의 Azure 구독 이름
- 리소스 그룹: **새로 만들기** 옵션이 선택되어있는지 확인하시고 **UDR** 이라는 이름을 새로운 리소스 그룹 이름으로 할당하세요
- 위치: 이용자 위치의 가장 가까운 Azure 지역을 선택하십시오
- 새 스토리지 계정 이름: 유일한 스토리지 게정 이름을 입력하십시오 (영어 소문자와 숫자만 가능합니다)
- Admin Username: **demouser**
- Admin Password: **DemoPa$$w0rd**
- Unique Dns Prefix for VM: VM을 위한 public DNS name을 생성하기 위해 유일한 접두사를 사용합니다. 검증 단계를 통과하기 위해 몇 개의 이름을 시도해야 할 수 있습니다.
- Vm Name Prefix: **vm**
- Public IP Address Type: **Dynamic**
- Windows OS Version: **2012-R2-Datacenter**
- 위에 명시된 사용 약관에 동의함: 체크

5. **구입**을 눌러 배포를 시작합니다. 배포가 완료될 때 까지 기다려 주십시오. 약 5분정도 시간이 소요됩니다. 


#### 단계 2: 템플릿 배포 검토

이 단계에서 우리는 가상 머신과 경로가 생성되었는지를 알아보기 위해 배포를 검토할 것입니다.

Azure portal에서, **More Services**를 클릭합니다. 서비스 목록에서, **경로 테이블**을 클릭합니다. **경로 테이블** 창에서, **BasicNVA**을 클릭하고 , **BasicNVA** 블레이드에서, **경로**를 클릭합니다. 그 다음, 경로 테이블에서 경로를 대표하는 엔트리를 클릭합니다. 이렇게하면 경로 테이블이 연결된 **FrontendSubnet**에서 시작된 10.1.2.0/24 서브넷 (**BackEndSubnet**)에 대한 트래픽이 10.1.1.4를 통해 전달된다고 표시됩니다. 이것은 **vm1**의 IP 주소이며, 이 경우 라우터로 작동합니다 (이 연습의 뒷부분에서 구성했을 때).
이 배포를 위해 우리가 사용하였던 리소스 템플릿 파일을 찾아보고 싶으시다면, https://github.com/Azure/azure-quickstart-templates/blob/master/201-userdefined-routes-appliance/azuredeploy.json 에서 확인하실 수 있으며, vm1에서 IP 포워딩이 활성화 되어 있습니다.


#### 단계 3: 경로 설정과 어플라이언스 VM에 대한 원격 접근

1. 템플릿 배포 중에 지정한 자격 증명으로 **vm0**(FrontEndSubnet) VM에 로그인하십시오.

2. 로그인 한 후 왼쪽 하단의 Windows 로고를 마우스 오른쪽 버튼으로 클릭하고 **명령 프롬프트 (관리자)**를 클릭하여 명령 프롬프트를 시작하십시오.

3. **vm0**의 명령 프롬프트에서`tracert vm2`를 실행하십시오. 경로 테이블에 기반하여 NVASubnet에 있는 vm1을 통해 BackendSubnet에 있는 vm2에 도달 할 것으로 예상할 수 있습니다. 하지만 이 시점에서, tracert `Request timed out`을 반환합니다. 여기에는 두 가지 이유가 있습니다:
- **vm1** (NVASubnet)을 라우터로 구성해야합니다.
- **vm1** (NVASubnet) 및 **vm2** (BackendSubnet) 모두에서 ICMP 트래픽을 허용해야합니다.

4. vm0 RDP 세션 창을 최소화하고 템플릿 배포 중에 지정한 자격 증명으로 RDP를 통해 **vm1** VM에 연결합니다.

5. vm1에 연결되면 왼쪽 하단의 Windows 로고를 마우스 오른쪽 단추로 클릭하고 **Run**을 클릭 한 다음 **Services.msc**를 입력하십시오.

6. 서비스 콘솔에서 **Routing and Remote Access** 서비스를 찾아 마우스 오른쪽 단추로 클릭 한 다음 **Properties**을 클릭하십시오. **Startup**type을 **Disabled**에서 **Automatic**으로 변경하고 **OK**을 클릭하십시오. 그런 다음 서비스를 마우스 오른쪽 버튼으로 클릭하고 **Start**을 클릭하십시오. 이 서비스는 LAN 및 WAN을 통한 라우팅을 구현합니다.

7. 왼쪽 하단에서 Windows 로고를 마우스 오른쪽 버튼으로 클릭하고 **Run**을 클릭 한 다음 **wf.msc**를 입력하십시오.

8. **Windows Firewall with Advanced Security** 콘솔에서 **Inbound Rules**을 클릭합니다. **File and Printer Sharing (Echo Request – ICMPv4-In)** 규칙을 찾아 마우스 오른쪽 단추로 클릭하고 **Enable Rule**을 클릭합니다.

9. vm1 RDP 세션 창을 최소화하고 RDP를 통해 vm2 VM에 연결하십시오.

10. vm2에 연결되면 왼쪽 하단의 Windows 로고를 마우스 오른쪽 단추로 클릭하고 **Run**을 클릭 한 다음 **wf.msc**를 입력하십시오.

11. **Windows Firewall with Advanced Security** 콘솔에서 **Inbound Rules**을 클릭합니다. **File and Printer Sharing (Echo Request – ICMPv4-In)** 규칙을 찾아 마우스 오른쪽 단추로 클릭하고 **Enable Rule**을 클릭합니다.

12. vm2 RDP 세션 창을 최소화하고 vm0 VM으로 다시 전환하고`tracert vm2`를 다시 실행하십시오. 이번에는 vm2와 hop 1으로 보이는 vm1에 도달하는 트래픽을 볼 수 있습니다.


#### 단계 4: 랩 환경 재설정 (선택 사항)
참고 : 랩 환경 실행과 관련된 비용을 최소화하려면 리소스 제거를 고려해야합니다. 이 단계의 목적입니다.

참고 : 랩 환경을 그대로 유지하려면 두 가상 시스템을 모두 중지하는 것이 좋습니다. 이렇게하면 이러한 가상 컴퓨터를 온라인 상태로 유지하는 것과 관련된 컴퓨팅 비용이 제거됩니다. 이러한 요금이 발생하지 않도록 하려면, Azure 포털에서 가상 머신을 중지하고 중지 된 (할당 취소 된) 상태 (중단됨이 아님)로 가상 머신 블레이드에 나열되는지 확인하십시오.

1. Azure 포털의 허브 메뉴에서 **리소스 그룹**을 클릭하십시오.

2. 리소스 그룹 블레이드에서 **UDR**을 클릭하십시오.

3. **UDR** 블레이드에서 **삭제**를 클릭하십시오.

4. **"UDR"을 삭제하시겠습니까?** 블레이드에서, **리소스 그룹 이름 입력** 텍스트 박스에서 **UDR**을 입력하시고, **삭제**를 클릭합니다.
