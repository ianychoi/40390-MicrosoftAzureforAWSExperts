# [Lab 실습]  모듈 5: 가상 네트워킹
## Lab 2: 가상 네트워크 피어링 설정

이 실습의 목적은 VNet 피어링을 사용하여 두 개의 가상 네트워크를 연결하는 것입니다.
이 실습에서는 동일한 Azure 지역의 서로 다른 두 가상 네트워크에 두 개의 가상머신을 만들고 VNet 피어링을 사용하여 두 가상 네트워크 간의 연결을 구성한 뒤, 두 가상머신 간의 직접 네트워크 연결을 확인합니다.

### 실습 1 : Azure 포털을 사용하여 랩 가상머신 만들기

이 실습의 주요 작업은 다음과 같습니다.
1. 첫 번째 가상머신 만들기
2. 두 번째 가상머신 만들기

#### 단계 1: 첫 번째 가상머신 만들기

1. 브라우저를 실행한 뒤 https://portal.azure.com 으로 접속하십시오.

2. 관리자 자격 증명을 사용하여 Azure 포털에 로그인하십시오.

3. Azure 포털의 허브 메뉴에서 **+ 새로 만들기**를 클릭하십시오.

4. 나타나는 블레이드에서 **계산**를 클릭하십시오.

5. **계산** 블레이드에서 **Windows Server 2016 Datacenter**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-005.png)

6. 나타나는 블레이드에서 페이지 맨 아래에서 배포 모델이 **Resource Manager**로 설정되어 있는지 확인하고 **만들기**를 클릭합니다.

7. **기본 사항** 블레이드에서 다음 설정을 지정하고 **확인**을 클릭하십시오.:

- 이름: **VM1**
- VM 디스크 유형: **HDD**
- 사용자 이름: **demouser**
- 암호: **DemoPa$$w0rd**
- 암호 확인: **DemoPa$$w0rd**
- 구독: 이 랩에 사용하는 구독 이름
- 리소스 그룹: **새로 만들기**가 선택되어 있는지 확인하고 아래 텍스트 상자에 **VNet1RG**를 입력하십시오.
- 위치: 현재 위치와 가장 가까운 Azure 지역을 선택하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-007.png)

8. **크기 선택** 블레이드에서 **모두보기**를 클릭하고 **A1 기본**을 클릭 한 다음 **선택**을 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-008.png)

9. **설정** 블레이드에서 **가상 네트워크**를 클릭하십시오.

10. **가상 네트워크 만들기** 블레이드에서 다음 설정을 지정하고 **확인**을 클릭하십시오.:

- 이름: **VNet1**
- 주소 공간: **10.0.0.0/22**
- 서브넷 이름: **Subnet1**
- 서브넷 주소 범위: **10.0.0.0/24**
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-010.png)

11. **모니터링** 섹션에서 **부트 진단** 아래의 **사용 안 함**를 클릭하고 **확인**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-011.png)

12. **요약** 블레이드에서 **확인**을 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise1-Task1-012.png)

  참고 : 첫 번째 가상머신이 프로비저닝 될 때까지 기다리지 말고 다음 작업으로 진행하십시오.


#### 단계 2: 두 번째 가상머신 만들기

1. Azure 포털의 허브 메뉴에서 **+ 새로 만들기**를 클릭하십시오.

2. 나타나는 블레이드에서 **계산**를 클릭하십시오.

3. **계산** 블레이드에서 **Windows Server 2016 Datacenter**를 클릭하십시오.

4. 나타나는 블레이드에서 페이지 맨 아래에서 배포 모델이 **Resource Manager**로 설정되어 있는지 확인하고 **만들기**를 클릭합니다.

5. **기본 사항** 블레이드에서 다음 설정을 지정하고 **확인**을 클릭하십시오.:

- 이름: **VM2**
- VM 디스크 유형: **HDD**
- 사용자 이름: **demouser**
- 암호: **DemoPa$$w0rd**
- 암호 확인: **DemoPa$$w0rd**
- 구독: 이 랩에 사용하는 구독 이름
- 리소스 그룹: **새로 만들기**가 선택되어 있는지 확인하고 아래 텍스트 상자에 **VNet2RG**를 입력하십시오.
- 위치: 이 실습의 첫 번째 작업에서 선택한 것과 같은 지역을 선택하십시오.

6. **크기 선택** 블레이드에서 **모두보기**를 클릭하고 **A1 기본**을 클릭 한 다음 **선택**을 클릭하십시오.

7. **설정** 블레이드에서 **가상 네트워크**를 클릭하십시오.

8. **가상 네트워크 만들기** 블레이드에서 다음 설정을 지정하고 **확인**을 클릭하십시오.:
  참고 : 두 개의 가상 네트워크를 연결하려면 중복되지 않는 IP 주소 공간이 있어야합니다. Azure 포털은 생성하려는 가상 네트워크가 동일한 구독에있는 기존 가상 네트워크와 중복되는 IP 주소 공간을 갖고 있는지 여부를 나타내는 시각적 단서를 제공합니다.:

- 이름: **VNet2**
- 주소 공간: **10.0.4.0/22**
- 서브넷 이름: **Subnet1**
- 서브넷 주소 범위: **10.0.4.0/24**

9. **모니터링** 섹션에서 **부트 진단** 아래의 **사용 안 함**를 클릭하고 **확인**를 클릭하십시오.

10. **요약** 블레이드에서 **확인**을 클릭하십시오.

  참고 : 두 번째 가상머신이 프로비저닝 될 때까지 기다리지 말고 다음 작업으로 진행하십시오.


### 실습 2: Azure 포털을 사용하여 VNet 피어링 구성

이 실습의 작업은 다음과 같습니다.
1. 첫 번째 VNet 피어링 링크 만들기
2. 두 번째 VNet 피어링 링크 만들기
3. 두 가상 네트워크 간의 연결 확인
4. 랩 환경 재설정 (선택 사항)


#### 단계 1: 랩 환경 (선택 사항)

1. Azure 포털의 허브 메뉴에서 **More services**를 클릭하십시오.

2. 서비스 목록의 **네트워킹** 섹션에서 **가상 네트워크**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task1-002.png)

3. **가상 네트워크** 블레이드에서 **VNet1**을 클릭하십시오.

4. 나타나는 블레이드에서 **피어링**을 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task1-004.png)

5. **+추가**를 클릭합니다.

6. **피어링 추가**에서 다음 설정을 지정하고 **확인**을 클릭하십시오.:

- 이름: **VNet2_peering**
- 가상 네트워크 배포 모델: **Resource manager** 
- 리소스 ID를 알고 있음: 체크하지 않음
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task1-006.png)

  참고 : VNet 피어링은 리소스 매니저 VNet과 클래식 VNet이 동일한 구독에 속하는 경우 지원됩니다. 이 제한 사항은 두 리소스 매니저 VNet 사이의 VNet 피어링에는 적용되지 않습니다. 만약 양측 구독이 모두 동일한 Azure Active Directory 테넌트와 연결되어 있으면, 두 개의 다른 구독에 속할 수 있습니다. 그러나 두 개의 클래식 VNet 간에는 VNet 피어링을 지원하지 않습니다.
  
  참고 : 리소스 ID를 알고있는 경우, Azure 포털 인터페이스(이 경우 의존하고있는 옵션)에서 사용 가능한 옵션을 사용하여 기존 가상 네트워크를 가리키는 대신 직접 리소스 ID를 입력 할 수 있습니다.

- 구독: 이 랩에서 사용하는 구독 이름
- 가상 네트워크: **가상 네트워크 선택**을 클릭하고 **가상 네트워크 선택** 블레이드에서 **VNet2**를 클릭하십시오.
- 가상 네트워크 액세스 허용 : **사용**
- 전달된 트래픽 허용: 체크하지 않음
- 게이트웨이 전송 허용: 체크하지 않음
- 원격 게이트웨이 사용: 체크하지 않음

  참고 : **전달 된 트래픽 허용** 설정은 피어 가상 네트워크에서 시작하지는 않지만 해당 가상 네트워크에서 가상 네트워크로 전달되는 트래픽을 가능하게합니다.
  **게이트웨이 전송 허용** 설정을 사용하면 다른 네트워크와의 연결을 위해 가상 네트워크에 구성된 가상 게이트웨이를 피어 가상 네트워크가 사용할 수 있습니다. 이를 위해서는 피어 가상 네트워크에서 원격 게이트웨이 사용 설정이 활성화되어 있어야합니다.


#### 단계 2: 두 번째 VNet 피어링 링크 만들기

1. Azure 포털의 허브 메뉴에서 **가상 네트워크** 블레이드로 다시 스크롤합니다.

2. **가상 네트워크** 블레이드에서 **VNet2**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task2-002.png)

3. 나타나는 블레이드에서 **피어링**을 클릭하십시오.

4. **+추가**를 클릭합니다.

5. **피어링 추가**에서 다음 설정을 지정하고 **확인**을 클릭하십시오.

- 이름: **VNet1_peering**
- 가상 네트워크 배포 모델: **Resource manager** 
- 리소스 ID를 알고 있음: 체크하지 않음
- 구독: 이 랩에서 사용하는 구독 이름
- 가상 네트워크: **가상 네트워크 선택**을 클릭하고 **가상 네트워크 선택** 블레이드에서 **VNet1**를 클릭하십시오.
- 가상 네트워크 액세스 허용 : **사용**
- 전달된 트래픽 허용: 체크하지 않음
- 게이트웨이 전송 허용: 체크하지 않음
- 원격 게이트웨이 사용: 체크하지 않음


#### 단계 3: 두 가상 네트워크 간의 연결 확인

참고 :이 작업을 진행하기 전에 두 가상 컴퓨터가 완전히 준비되었는지 확인하십시오.

1. Azure 포털의 허브 메뉴에서 **More services**를 클릭하십시오.

2. 서비스 목록의 **계산** 섹션에서 **가상 컴퓨터**를 클릭합니다.

3. **가상 컴퓨터** 블레이드에서 **VM1**을 클릭하십시오.

4. 나타나는 블레이드에서 **연결**을 클릭하십시오.

5. VM1.rdp를 열거 나 저장할 것인지 묻는 메시지가 표시되면 **열기**를 클릭합니다.

6. **원격 데스크톱 연결** 대화 상자에서 **연결**을 클릭하십시오.

7. **Windows 보안** 대화 상자에서 사용자 이름으로 **demouser**를 입력하고 암호로 **DemoPa$$w0rd**를 입력하고 **확인**을 클릭하십시오.

8. **원격 데스크톱 연결** 대화 상자에서 **예**를 클릭하십시오

9. Azure 포털로 다시 전환하여 **가상 컴퓨터** 블레이드로 다시 스크롤하십시오.

10. **가상 컴퓨터** 블레이드에서 **VM2**을 클릭하십시오.

11. **VM2** 블레이드에서 **네트워크 인터페이스**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task3-011.png)

12. **VM2 - 네트워크 인터페이스** 블레이드에서 VM2의 네트워크 인터페이스의 **개인 IP 주소** 열에 나타나는 항목을 기록하십시오( 10.0.4.4 이어야 함).

13. VM1에 대한 원격 데스크톱 세션으로 전환하십시오.

14. VM1에 대한 원격 데스크톱 세션에서 시작을 마우스 오른쪽 단추로 클릭하고 마우스 오른쪽 단추 클릭 메뉴에서 **Run**을 클릭합니다.

15. **Run** 대화 상자에서 'mstsc /v:10.0.4.4`를 입력하십시오.

  참고 : 내장 된 Azure DNS는 VNet 피어링을 통해 연결된 Azure 가상 네트워크 간의 이름 확인을 지원하지 않습니다. 이는 이 시나리오에서 VM 이름 (예 : VM2)을 지정할 수없는 이유입니다. 그러나 이 기능을 제공하는 사용자 지정 DNS 솔루션을 구현할 수 있습니다.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task3-015.png)

16. 10.0.4.4에 연결하는 데 사용할 자격 증명을 묻는 메시지가 나타나면 사용자 이름으로 **demouser**를 입력하고 암호로 **DemoPa$$w0rd**를 입력하십시오.

17. **원격 데스크톱 연결** 대화 상자에서 **예**를 클릭하십시오.

18. VM2에 성공적으로 연결되었는지 확인하십시오.

19. VM2에 대한 원격 데스크톱 세션을 닫습니다.

20. VM1에 대한 원격 데스크톱 세션을 닫습니다.


#### 단계 4: 랩 환경 재설정 (선택 사항)

참고 : 랩 환경 실행과 관련된 비용을 최소화하려면 리소스 제거를 고려해야합니다. 이 단계의 목적입니다.

참고 : 랩 환경을 그대로 유지하려면 두 가상 시스템을 모두 중지하는 것이 좋습니다. 이렇게하면 이러한 가상 컴퓨터를 온라인 상태로 유지하는 것과 관련된 컴퓨팅 비용이 제거됩니다. 이러한 요금이 발생하지 않도록하려면 Azure 포털에서 가상 시스템을 중지하고 중지 된 (할당 취소 된) 상태 (중단됨이 아님)로 가상 시스템 블레이드에 나열되는지 확인하십시오.

1. Azure 포털의 허브 메뉴에서 **리소스 그룹**을 클릭하십시오.

2. 리소스 그룹 블레이드에서 **VNet1RG**를 클릭하십시오.
![image](https://github.com/ianychoi/40390-MicrosoftAzureforAWSExperts/blob/ko-kr/Images/40390B_LAB_AK_0502-Lab2-Exercise2-Task4-002.png)

3. **VNet1RG** 블레이드에서 **삭제**를 클릭하십시오.

4. **"VNet1RG"을 삭제하시겠습니까?** 블레이드에서, **리소스 그룹 이름 입력** 텍스트 박스에서 **VNet1RG**을 입력하시고, **삭제**를 클릭합니다.

5. 리소스 그룹 블레이드에서 **VNet2RG**를 클릭하십시오.

6. **VNet2RG** 블레이드에서 **삭제**를 클릭하십시오.

7. **"VNet2RG"을 삭제하시겠습니까?** 블레이드에서, **리소스 그룹 이름 입력** 텍스트 박스에서 **VNet2RG**을 입력하시고, **삭제**를 클릭합니다.
